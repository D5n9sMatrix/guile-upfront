
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Conditional Compilation</title>
    <style type="text/css" media="screen">
      html, body, div, span, object, iframe, h1, h2, h3, h4, h5, h6, p,
      blockquote, pre, a, abbr, address, cite, code, del, dfn, em, figure,
      img, ins, kbd, q, s, samp, small, strong, sub, sup, var, b, u, i, dl,
      dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption,
      tbody, tfoot, thead, tr, th, td {
        background: transparent none repeat scroll 0 0;
        border: 0 none;
        font-size: 100%;
        margin: 0;
        outline: 0 none;
        padding: 0;
        vertical-align: baseline;
      }

      h1 { font-size: 200%; }
      h2 { font-size: 160%; }
      h3 { font-size: 120%; }
      h4 { font-size: 100%; }
      h5 { font-size: 80%; }
      h6 { font-size: 80%; font-weight: normal; }

      ul, ol {
        margin: 1.4em 0;
      }
      ul ul, ol ol, ul ol, ol ul {
        margin-top: 0;
        margin-bottom: 0;
      }
      ul, ol {
        margin-left: 2.8em;
      }

      ol {
        list-style: decimal;
      }
      ol ol {
        list-style: lower-alpha;
      }
      ol ol ol {
        list-style: lower-roman;
      }
      ol ol ol ol {
        list-style: decimal;
      }

      blockquote {
        margin: 0.1em;
        margin-left: 1em;
        border-left: 2px solid #cccccc;
        padding-left: 0.7em;
      }

      .color_red { color: #dc322f; }
      .color_blue { color: #268bd2; }
      .color_green { color: #859901; }
      .color_yellow { color: #b58901; }
      .color_black { color: black; }
      .color_white { color: white; }

      .font_big {
        font-size: 1.2em;
      }

      .ddoc_section_h {
        font-weight: bold;
        font-size: 13px;
        line-height: 19.5px;
        margin-top: 11px;
        display: block;
      }

      body.dlang .dlang {
        display: inline-block;
      }

      body.dlang .declaration .dlang {
          display: block;
      }

      body.dlang .ddoc_header_anchor a.dlang {
        display: block;
        color: rgba(0, 136, 204, 1);
        text-decoration: none;
      }

      body.dlang .ddoc_header_anchor .code {
        color: rgba(0, 136, 204, 1);
      }

      #ddoc_main .module {
          border-color: currentColor rgba(233, 233, 233, 1) rgba(233, 233, 233, 1);
          border-style: none solid solid;
          border-width: 0 1px 1px;
          overflow-x: hidden;
          padding: 15px;
      }

      #ddoc_main .section .section {
        margin-top: 0;
      }

      #ddoc_main .ddoc_module_members_section {
          padding: 1px 0 0;
          transition: transform 0.3s ease 0s;
      }

      #ddoc_main .ddoc_member, #ddoc_main .ddoc_module_members section.intro {
          background: #fff none repeat scroll 0 0;
          list-style-type: none;
          width: 100%;
      }

      #ddoc_main .ddoc_header_anchor {
          font-size: 1.4em;
          transition: transform 0.3s ease 0s;
      }

      #ddoc_main .ddoc_header_anchor > .code {
          display: inline-block;

      }

      #ddoc_main .ddoc_decl {
        background-color: transparent;
        height: 100%;
        left: 0;
        top: 0;
        padding: 0;
        padding-left: 15px;
      }

      #ddoc_main .ddoc_decl .section, #ddoc_main .section.ddoc_sections {
        background: white none repeat scroll 0 0;
        margin: 0;
        padding: 5px;
        position: relative;
        border-radius: 5px;
      }

      #ddoc_main .ddoc_decl .section h4:first-of-type, #ddoc_main .section.ddoc_sections h4:first-of-type {
        font-size: 13px;
        line-height: 1.5;
        margin-top: 21px;
      }

      #ddoc_main .section .declaration {
          margin-top: 21px;
      }

      #ddoc_main .section .declaration .code {
          color: rgba(0, 0, 0, 1);
          margin-bottom: 15px;
          padding-bottom: 6px;
      }

      #ddoc_main .declaration div .para {
          margin-bottom: 0;
      }

      #ddoc_main .ddoc_params .graybox tr td:first-of-type {
        padding: 7px;
        text-align: right;
        vertical-align: top;
        word-break: normal;
        white-space: nowrap;
      }

      #ddoc_main .ddoc_params .graybox {
        border: 0 none;
      }

      #ddoc_main .ddoc_params .graybox td {
        border-color: rgba(214, 214, 214, 1);
      }

      #ddoc_main .ddoc_params .graybox tr:first-child > td {
        border-top: 0 none;
      }

      #ddoc_main .ddoc_params .graybox tr:last-child > td {
        border-bottom: 0 none;
      }

      #ddoc_main .ddoc_params .graybox tr > td:first-child {
        border-left: 0 none;
      }

      #ddoc_main .ddoc_params .graybox tr > td:last-child {
        border-right: 0 none;
        width: 100%;
      }

      #ddoc_main em.term, #ddoc_main em.term .code {
        color: rgba(65, 65, 65, 1);
        font-size: 12px;
        font-style: italic;
        line-height: 1.5;
      }

      #ddoc_main .see-also {
        cursor: pointer;
        font-family: Menlo,monospace;
      }

      #ddoc_main .ddoc_decl .section > div:last-of-type {
        margin-bottom: 15px;
      }

      #ddoc_main .ddoc_member, #ddoc_main .ddoc_module_members {
          transition: transform 0.3s ease 0s;
      }

      #ddoc_main .code_sample {
        background: inherit;
      }

      #ddoc_main .declaration .code-line {
          display: block;
          font: 1em Menlo,monospace;
      }

      #ddoc_main a[name] {
        margin: -112px 0 0;
        padding-top: 112px;
      }

      #ddoc_main .ddoc_decl td {
        max-width: inherit;
      }

      #ddoc_main .declaration a {
        color: inherit;
      }

      #ddoc_main .declaration a:hover {
          color: rgba(0, 136, 204, 1);
          text-decoration: underline;
      }

      body.ddoc {
        background-color: transparent;
        color: rgba(0, 0, 0, 1);
        font-family: Helvetica,Arial,sans-serif;
        font-size: 62.5%;
        margin: 0;
        border: 0;
        left: 0;
        top: 0;
        padding: 0;
      }

      .ddoc a[name] {
        display: block;
        height: 0;
        margin: -85px 0 0;
        padding-top: 85px;
        width: 0;
      }

      .ddoc .module {
          border-color: transparent;
          background-color: rgba(255, 255, 255, 1);
          border-color: currentColor rgba(233, 233, 233, 1) rgba(233, 233, 233, 1);
          border-image: none;
          border-style: none solid solid;
          border-width: 0 1px 1px;
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.07);
          display: block;
          margin-left: 0;
          min-height: calc(100% - 173px);
          overflow: auto;
          padding-bottom: 100px;
      }

      .ddoc .content_wrapper {
          background-color: rgba(242, 242, 242, 1);
          margin: 0 auto;
          max-width: 980px;
      }

      .ddoc .section {
        padding: 15px 25px 30px;
      }

      .ddoc .section .section {
        margin: 30px 0 0;
        padding: 0;
      }

      .ddoc .para {
        color: rgba(65, 65, 65, 1);
        font-size: 1.4em;
        line-height: 145%;
        margin-bottom: 15px;
      }

      .ddoc .ddoc_examples .para {
        margin-bottom: 0;
      }

      .ddoc .module_name {
          color: rgba(0, 0, 0, 1);
          display: block;
          font-family: Helvetica;
          font-size: 2.8em;
          font-weight: 100;
          margin-bottom: 0;
          padding: 15px 0;
      }

      .ddoc .module a {
          color: rgba(0, 136, 204, 1);
          text-decoration: none;
      }

      .ddoc .code {
        color: rgba(128, 128, 128, 1);
        font-family: Menlo,monospace;
        font-size: 0.85em;
        word-wrap: break-word;
      }

      .ddoc .code i {
        font-style: normal;
      }

      .ddoc .code .code {
        font-size: 1em;
      }

      .ddoc .code_sample {
        background-clip: padding-box;
        margin: 1px 0;
        text-align: left;
      }

      .ddoc .code_sample {
        display: block;
        font-size: 1.4em;
        margin-left: 21px;
      }

      .ddoc ol .code_sample {
        font-size: 1em;
      }

      .ddoc .code_lines {
        counter-reset: li;
        line-height: 1.6em;
        list-style: outside none none;
        margin: 0;
        padding: 0;
      }

      .ddoc .code_listing .code_sample div {
        margin-left: 13px;
        width: 93%;
      }

      .ddoc .code_listing .code_sample div .code_lines li {
        list-style-type: none;
        margin: 0;
        padding-right: 10px;
      }

      .ddoc .code_sample div .code_lines li::before {
        margin-left: -33px;
        margin-right: 25px;
      }

      .ddoc .code_sample div .code_lines li:nth-child(n+10)::before {
        margin-left: -39px;
        margin-right: 25px;
      }

      .ddoc .code_sample div .code_lines li:nth-child(n+100)::before {
        margin-left: -46px;
        margin-right: 25px;
      }

      .ddoc .code_sample .code_lines .code {
        color: #000;
      }

      .ddoc div.dlang {
        margin: 10px 0 21px;
        padding: 4px 0 2px 10px;
      }

      .ddoc div.dlang {
          margin: 10px 0 21px;
          padding: 4px 0 2px 10px;
      }

      .ddoc div.dlang {
        border-left: 5px solid rgba(0, 155, 51, 0.2);
      }

      .ddoc .code_lines li::before {
        color: rgba(128, 128, 128, 1);
        content: counter(li, decimal);
        counter-increment: li;
        font-family: Menlo,monospace;
        font-size: 0.9em;
        margin-right: 16px;
      }

      .ddoc .code_lines li {
        padding-left: 0;
        white-space: pre-wrap;
      }

      .ddoc .code_lines li:only-of-type::before {
        color: rgba(255, 255, 255, 1);
        content: " ";
      }

      .ddoc .code_lines li:only-of-type {
        color: rgba(255, 255, 255, 1);
        content: " ";
      }

      .ddoc .code_lines li:nth-child(n+10) {
        text-indent: -17px;
      }

      .ddoc .code_lines li:nth-child(n+10)::before {
        margin-right: 12px;
      }

      .ddoc .graybox {
        border: 1px solid rgba(233, 233, 233, 1);
        border-collapse: collapse;
        border-spacing: 0;
        empty-cells: hide;
        margin: 20px 0 36px;
        text-align: left;
      }

      .ddoc .graybox p {
        margin: 0;
        min-width: 50px;
      }

      .ddoc th {
        margin: 0;
        max-width: 260px;
        padding: 5px 10px 5px 10px;
        vertical-align: bottom;
      }

      .ddoc td {
        border: 1px solid rgba(233, 233, 233, 1);
        margin: 0;
        max-width: 260px;
        padding: 5px 10px 5px 10px;
        vertical-align: middle;
      }

      .punctuation {
        color: rgba(0, 0, 0, 1);
      }

      .comment {
        color: rgba(0, 131, 18, 1);
      }

      .operator {
        color: #000;
      }

      .keyword {
        color: rgba(170, 13, 145, 1);
      }

      .keyword_type {
        color: rgba(170, 51, 145, 1);
      }

      .string_literal {
        color: rgba(196, 26, 22, 1);
      }

      .ddoc_psuper_symbol {
        color: rgba(92, 38, 153, 1);
      }

      .param {
        color: rgba(0, 0, 0, 1);
      }

      .psymbol {
        color: rgba(0, 0, 0, 1);
      }

      .ddoc_member_header .ddoc_header_anchor .code {
        font-size: 1em;
      }
    </style>
  </head>
  <body id="ddoc_main" class="ddoc dlang">
    <div class="content_wrapper">
      <article class="module">
        <h1 class="module_name">Conditional Compilation</h1>
        <section id="module_content"><br><br>
<br><br>

<br><br>
<p>Conditional compilation is for compiling parts of programs in special ways depending on certain compile time conditions. Sometimes, entire sections of a program may need to be taken out and not compiled at all.
</p>
<br><br>
<p>Conditional compilation involves condition checks that are evaluable at compile time. Runtime conditional statements like , ,  are not conditional compilation features.
</p>
<br><br>
<p>We have already encountered some features in the previous chapters, which can be seen as conditional compilation:
</p>
<br><br>
<ul><br><br>
<li> blocks are compiled and run only if the  compiler switch is enabled.
</li>
<br><br>
<li>The contract programming blocks , , and  are activated only if the  compiler switch is <i>not</i> enabled.
</li>
<br><br>
</ul>
<br><br>
<p>Unit tests and contracts are about program correctness; whether they are included in the program should not change the behavior of the program.
</p>
<br><br>
<p>The following are the features of D that are specifically for conditional compilation:
</p>
<br><br>
<ul><li></li>
<li></li>
<li></li>
<li> expression</li>
<li></li>
</ul>
<br><br>
<p>We will see the  expression in the next chapter.
</p>
<br><br>
<h5> debug</h5>
<br><br>
<p>  is useful during program development. The expressions and statements that are marked as  are compiled into the program only when the  compiler switch is enabled:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">debug</span> <i>a_conditionally_compiled_expression</i>;

<span class="keyword">debug</span> {
    <span class="comment">// ... conditionally compiled code ...
</span>
} <span class="keyword">else</span> {
    <span class="comment">// ... code that is compiled otherwise ...
</span>}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>The  clause is optional.
</p>
<br><br>
<p>Both the single expression and the code block above are compiled only when the  compiler switch is enabled.
</p>
<br><br>
<p>We have been adding statements into the programs, which printed messages like "adding", "subtracting", etc. to the output. Such messages (aka <i>logs</i> and <i>log</i> messages) are helpful in finding errors by visualizing the steps that are taken by the program.
</p>
<br><br>
<p>Remember the  function from <a href="templates.html">the Templates chapter</a>. The following version of the function is intentionally incorrect:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">import</span> std.stdio;

<span class="comment">// WARNING! This algorithm is wrong
</span>size_t binarySearch(<span class="keyword">const</span> <span class="keyword">int</span>[] values, <span class="keyword">int</span> value) {
    <span class="keyword">if</span> (values.length == 0) {
        <span class="keyword">return</span> size_t.max;
    }

    <span class="keyword">immutable</span> midPoint = values.length / 2;

    <span class="keyword">if</span> (value == values[midPoint]) {
        <span class="keyword">return</span> midPoint;

    } <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; values[midPoint]) {
        <span class="keyword">return</span> binarySearch(values[0 .. midPoint], value);

    } <span class="keyword">else</span> {
        <span class="keyword">return</span> binarySearch(values[midPoint + 1 .. $], value);
    }
}

<span class="keyword">void</span> main() {
    <span class="keyword">auto</span> numbers = [ -100, 0, 1, 2, 7, 10, 42, 365, 1000 ];

    <span class="keyword">auto</span> index = binarySearch(numbers, 42);
    writeln(<span class="string_literal">"Index: "</span>, index);
}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>Although the index of 42 is 6, the program incorrectly reports 1:
</p>
<br><br>

<br><br>
<p>One way of locating the bug in the program is to insert lines that would print messages to the output:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">size_t binarySearch(<span class="keyword">const</span> <span class="keyword">int</span>[] values, <span class="keyword">int</span> value) {
    (<span class="string_literal">"searching %s among %s"</span>, value, values);

    <span class="keyword">if</span> (values.length == 0) {
        (<span class="string_literal">"%s not found"</span>, value);
        <span class="keyword">return</span> size_t.max;
    }

    <span class="keyword">immutable</span> midPoint = values.length / 2;

    (<span class="string_literal">"considering index %s"</span>, midPoint);

    <span class="keyword">if</span> (value == values[midPoint]) {
        (<span class="string_literal">"found %s at index %s"</span>, value, midPoint);
        <span class="keyword">return</span> midPoint;

    } <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; values[midPoint]) {
        (<span class="string_literal">"must be in the first half"</span>);
        <span class="keyword">return</span> binarySearch(values[0 .. midPoint], value);

    } <span class="keyword">else</span> {
        (<span class="string_literal">"must be in the second half"</span>);
        <span class="keyword">return</span> binarySearch(values[midPoint + 1 .. $], value);
    }
}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>The output of the program now includes steps that the program takes:
</p>
<br><br>

<br><br>
<p>Let's assume that the previous output does indeed help the programmer locate the bug. It is obvious that the  expressions are not needed anymore once the bug has been located and fixed. However, removing those lines can also be seen as wasteful, because they might be useful again in the future.
</p>
<br><br>
<p>Instead of being removed altogether, the lines can be marked as  instead:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">         writefln(<span class="string_literal">"%s not found"</span>, value);
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>Such lines are included in the program only when the  compiler switch is enabled:
</p>
<br><br>

<br><br>
<h6></h6>
<br><br>
<p>If there are many  keywords in the program, possibly in unrelated parts, the output may become too crowded. To avoid that, the  statements can be given names (tags) to be included in the program selectively:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">         writefln(<span class="string_literal">"%s not found"</span>, value);
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>The tagged  statements are enabled by the  compiler switch:
</p>
<br><br>

<br><br>
<p> blocks can have tags as well:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">    <span class="keyword">debug</span>(binarySearch) {
        <span class="comment">// ...
</span>    }
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>It is possible to enable more than one  tag at a time:
</p>
<br><br>

<br><br>
<p>In that case both the  and the  debug statements and blocks would be included.
</p>
<br><br>
<h6></h6>
<br><br>
<p>Sometimes it is more useful to associate  statements by numerical levels. Increasing levels can provide more detailed information:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"> <span class="keyword">import</span> std.stdio;

<span class="keyword">void</span> myFunction(string fileName, <span class="keyword">int</span>[] values) {
     writeln(<span class="string_literal">"entered myFunction"</span>);

     {
        writeln(<span class="string_literal">"the arguments:"</span>);
        writeln(<span class="string_literal">"  file name: "</span>, fileName);

        <span class="keyword">foreach</span> (i, value; values) {
            writefln(<span class="string_literal">"  %4s: %s"</span>, i, value);
        }
    }

    <span class="comment">// ... the implementation of the function ...
</span>}

<span class="keyword">void</span> main() {
    myFunction(<span class="string_literal">"deneme.txt"</span>, [ 10, 4, 100 ]);
}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>The  expressions and blocks that are lower than or equal to the specified level would be compiled:
</p>
<br><br>

<br><br>
<p>The following compilation would provide more information:
</p>
<br><br>

<br><br>
<h5>  and </h5>
<br><br>
<p> is similar to  and is used in the same way:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">    <span class="keyword">version</span>(testRelease) <span class="comment">/* ... an expression ... */</span>;

    <span class="keyword">version</span>(schoolRelease) {
        <span class="comment">/* ... expressions that are related to the version of
         *     this program that is presumably shipped to schools ... */</span>

    } <span class="keyword">else</span> {
        <span class="comment">// ... code compiled otherwise ...
</span>    }

    <span class="keyword">version</span>(1) aVariable = 5;

    <span class="keyword">version</span>(2) {
        <span class="comment">// ... a feature of version 2 ...
</span>    }
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>The  clause is optional.
</p>
<br><br>
<p>Although  works essentially the same as , having separate keywords helps distinguish their unrelated uses.
</p>
<br><br>
<p> As with , more than one  can be enabled:
</p>
<br><br>

<br><br>
<p>There are many predefined  tags, the complete list of which is available at the <a href="http://dlang.org/version.html">Conditional Compilation specification</a>. The following short list is just a sampling:
</p>
<br><br>
<table class="full" border="1" cellpadding="4" cellspacing="0"><caption>Predefined  tags</caption>
<br><br>
<tr><td>The compiler</td> <td><b>DigitalMars GNU LDC SDC</b></td></tr>
<br><br>
<tr><td>The operating system</td> <td><b>Windows Win32 Win64 linux OSX Posix FreeBSD
OpenBSD
NetBSD
DragonFlyBSD
BSD
Solaris
AIX
Haiku
SkyOS
SysV3
SysV4
Hurd</b></td></tr>
<br><br>
<tr><td>CPU endianness</td><td><b>LittleEndian BigEndian</b></td></tr>
<tr><td>Enabled compiler switches</td> <td> <b>D_Coverage D_Ddoc D_InlineAsm_X86 D_InlineAsm_X86_64 D_LP64 D_PIC D_X32
D_HardFloat
D_SoftFloat
D_SIMD
D_Version2
D_NoBoundsChecks
unittest
assert
</b></td></tr>
<br><br>
<tr><td>CPU architecture</td> <td><b>X86 X86_64</b></td></tr>
<tr><td>Platform</td> <td><b>Android
Cygwin
MinGW
ARM
ARM_Thumb
ARM_Soft
ARM_SoftFP
ARM_HardFP
ARM64
PPC
PPC_SoftFP
PPC_HardFP
PPC64
IA64
MIPS
MIPS32
MIPS64
MIPS_O32
MIPS_N32
MIPS_O64
MIPS_N64
MIPS_EABI
MIPS_NoFloat
MIPS_SoftFloat
MIPS_HardFloat
SPARC
SPARC_V8Plus
SPARC_SoftFP
SPARC_HardFP
SPARC64
S390
S390X
HPPA
HPPA64
SH
SH64
Alpha
Alpha_SoftFP
Alpha_HardFP
</b></td></tr>
<tr><td>...</td> <td>...</td></tr>
</table>
<br><br>
<p>In addition, there are the following two special  tags:
</p>
<br><br>
<ul><li> : This tag is never defined; it is useful for disabling code blocks.</li>
<li> : This tag is always defined; it is useful for enabling code blocks.</li>
</ul>
<br><br>
<p>As an example of how predefined  tags are used, the following is an excerpt (formatted differently here) from the  module, which is for determining the newline character sequence for the system ( will be explained later below):
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">version</span>(Windows) {
    <span class="keyword">immutable</span> newline = <span class="string_literal">"\r\n"</span>;

} <span class="keyword">else</span> <span class="keyword">version</span>(Posix) {
    <span class="keyword">immutable</span> newline = <span class="string_literal">"\n"</span>;

} <span class="keyword">else</span> {
    <span class="keyword">static</span> <span class="keyword">assert</span>(0, <span class="string_literal">"Unsupported OS"</span>);
}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<h5>Assigning identifiers to  and </h5>
<br><br>
<p>Similar to variables,  and  can be assigned identifiers. Unlike variables, this assignment does not change any value, it activates the specified identifier <i>as well</i>.
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">import</span> std.stdio;

<span class="keyword">debug</span>(everything) {
    <span class="keyword">debug</span>  binarySearch;
    <span class="keyword">debug</span>  stackContainer;
    <span class="keyword">version</span>  testRelease;
    <span class="keyword">version</span>  schoolRelease;
}

<span class="keyword">void</span> main() {
    <span class="keyword">debug</span>(binarySearch) writeln(<span class="string_literal">"binarySearch is active"</span>);
    <span class="keyword">debug</span>(stackContainer) writeln(<span class="string_literal">"stackContainer is active"</span>);

    <span class="keyword">version</span>(testRelease) writeln(<span class="string_literal">"testRelease is active"</span>);
    <span class="keyword">version</span>(schoolRelease) writeln(<span class="string_literal">"schoolRelease is active"</span>);
}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>The assignments inside the  block above activates all of the specified identifiers:
</p>
<br><br>

<br><br>
<h5>  </h5>
<br><br>
<p> is the compile time equivalent of the  statement.
</p>
<br><br>
<p>Just like the  statement,  takes a logical expression and evaluates it. Unlike the  statement,  is not about execution flow; rather, it determines whether a piece of code should be included in the program or not.
</p>
<br><br>
<p>The logical expression must be evaluable at compile time. If the logical expression evaluates to , the code inside the  gets compiled. If the condition is , the code is not included in the program as if it has never been written. The logical expressions commonly take advantage of the  expression and .
</p>
<br><br>
<p> can appear at module scope or inside definitions of , , template, etc. Optionally, there may be  clauses as well.
</p>
<br><br>
<p>Let's use  with a simple template, making use of the  expression. We will see other examples of  in the next chapter:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">import</span> std.stdio;

<span class="keyword">struct</span> MyType(T) {
    <span class="keyword">static</span> <span class="keyword">if</span> (<span class="keyword">is</span> (T == <span class="keyword">float</span>)) {
        <span class="keyword">alias</span> ResultType = <span class="keyword">double</span>;

    }  (<span class="keyword">is</span> (T == <span class="keyword">double</span>)) {
        <span class="keyword">alias</span> ResultType = <span class="keyword">real</span>;

    } <span class="keyword">else</span> {
        <span class="keyword">static</span> <span class="keyword">assert</span>(<span class="keyword">false</span>, T.stringof ~ <span class="string_literal">" is not supported"</span>);
    }

    ResultType doWork() {
        writefln(<span class="string_literal">"The return type for %s is %s."</span>,
                 T.stringof, ResultType.stringof);
        ResultType result;
        <span class="comment">// ...
</span>        <span class="keyword">return</span> result;
    }
}

<span class="keyword">void</span> main() {
    <span class="keyword">auto</span> f = MyType!<span class="keyword">float</span>();
    f.doWork();

    <span class="keyword">auto</span> d = MyType!<span class="keyword">double</span>();
    d.doWork();
}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>According to the code,  can be used only with two types:  or . The return type of  is chosen depending on whether the template is instantiated for  or :
</p>
<br><br>

<br><br>
<p>Note that one must write  when chaining  clauses. Otherwise, writing  would result in inserting that  conditional into the code, which would naturally be executed at run time.
</p>
<br><br>
<h5> </h5>
<br><br>
<p>Although it is not a conditional compilation feature, I have decided to introduce  here.
</p>
<br><br>
<p> is the compile time equivalent of . If the conditional expression is , the compilation gets aborted due to that assertion failure.
</p>
<br><br>
<p>Similar to ,  can appear in any scope in the program.
</p>
<br><br>
<p>We have seen an example of  in the program above: There, compilation gets aborted if  is any type other than  or :
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">    <span class="keyword">auto</span> i = MyType!();
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>The compilation is aborted with the message that was given to :
</p>
<br><br>

<br><br>
<p>As another example, let's assume that a specific algorithm can work only with types that are a multiple of a certain size. Such a condition can be ensured at compile time by a :
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">T myAlgorithm(T)(T value) {
    <span class="comment">/* This algorithm requires that the size of type T is a
     * multiple of 4. */</span>
    <span class="keyword">static</span> <span class="keyword">assert</span>((T.sizeof % 4) == 0);

    <span class="comment">// ...
</span>}
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>If the function was called with a , the compilation would be aborted with the following error message:
</p>
<br><br>

<br><br>
<p>Such a test prevents the function from working with an incompatible type, potentially producing incorrect results.
</p>
<br><br>
<p> can be used with any logical expression that is evaluable at compile time.
</p>
<br><br>
<h5>  Type traits</h5>
<br><br>
<p>  The  keyword and the  module provide information about types and expressions at compile time.
</p>
<br><br>
<p>Some information that is collected by the compiler is made available to the program by . Its syntax includes a traits <i>keyword</i> and <i>parameters</i> that are relevant to that keyword:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">    <span class="keyword">__traits</span>(<i>keyword</i>, <i>parameters</i>)
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p><i>keyword</i> specifies the information that is being queried. The <i>parameters</i> are either types or expressions, meanings of which are determined by each particular keyword.
</p>
<br><br>
<p>The information that can be gathered by  is especially useful in templates. For example, the  keyword can determine whether a particular template parameter  is an arithmetic type:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code">    <span class="keyword">static</span> <span class="keyword">if</span> (<span class="keyword">__traits</span>(, T)) {
        <span class="comment">// ... an arithmetic type ...
</span>
    } <span class="keyword">else</span> {
        <span class="comment">// ... not an arithmetic type ...
</span>    }
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>Similarly, the  module provides information at compile time through its templates. For example,  returns  if its template parameter is a character type:
</p>
<br><br>

<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">import</span> std.traits;

<span class="comment">// ...
</span>
    <span class="keyword">static</span> <span class="keyword">if</span> (!T) {
        <span class="comment">// ... char, wchar, or dchar ...
</span>
    } <span class="keyword">else</span> {
        <span class="comment">// ... not a character type ...
</span>    }
</code></li>
      </ol>
    </div>
  </div>
</section>
<br><br>
<p>Please refer to <a href="http://dlang.org/traits.html">the  documentation</a> and <a href="http://dlang.org/phobos/std_traits.html">the  documentation</a> for more information.
</p>
<br><br>
<h5>Summary</h5>
<br><br>
<ul><br><br>
<li>Code that is defined as  is included to the program only if the  compiler switch is used.
</li>
<br><br>
<li>Code that is defined as  is included to the program only if a corresponding  compiler switch is used.
</li>
<br><br>
<li> is similar to an  statement that is executed at compile time. It introduces code to the program depending on certain compile-time conditions.
</li>
<br><br>
<li> validates assumptions about code at compile time.
</li>
<br><br>
<li> and  provide information about types at compile time.</li>
<br><br>
</ul>

</section>
      </article>
    </div>
  </body>
</html>
